<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragment/head :: head}"></head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
	<header th:replace="~{fragment/header :: header}"></header>
	<div th:replace="~{fragment/sidebar :: sidebar}"></div>

	<div class="content-wrapper">
		<section class="content-header">
			<h1 th:text="'Chi tiết đơn hàng #' + ${order.id}"></h1>
			<ol class="breadcrumb">
				<li><a th:href="@{/admin/orders}"><i class="fa fa-shopping-cart"></i> Đơn hàng</a></li>
				<li class="active">Chi tiết</li>
			</ol>
		</section>

		<section class="content">
			<div class="row">
				<div class="col-md-8">
					<div class="box box-primary">
						<div class="box-header with-border"><h3 class="box-title">Sản phẩm trong đơn</h3></div>
						<div class="box-body no-padding">
							<table class="table">
								<tbody>
								<tr th:each="item : ${order.items}">
									<td th:text="${item.productName}"></td>
									<td class="text-center" th:text="'SL: ' + ${item.quantity}"></td>
									<td class="text-right" th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
								</tr>
								</tbody>
							</table>
						</div>
						<div class="box-footer text-right">
							<h4>Tổng tiền: <strong th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></strong></h4>
						</div>
					</div>

					<div class="box box-warning">
						<div class="box-header with-border">
							<h3 class="box-title">Thông tin thanh toán & Trạng thái</h3>
						</div>
						<div class="box-body">
							<p><strong>Phương thức:</strong> <span th:text="${order.paymentMethod}"></span></p>
							<p><strong>Trạng thái:</strong>
								<span class="label" th:text="${order.status}" th:classappend="${order.status.name() == 'DELIVERED' ? 'label-success' : (order.status.name() == 'PENDING' ? 'label-warning' : (order.status.name() == 'CANCELLED' or order.status.name() == 'REJECTED' ? 'label-danger' : 'label-info'))}"></span>
							</p>
							<div th:if="${order.cancelReason != null or order.adminNote != null}">
								<hr>
								<p class="text-danger" th:if="${order.cancelReason}"><strong>Lý do:</strong> <span th:text="${order.cancelReason}"></span></p>
								<p class="text-muted" th:if="${order.adminNote}"><strong>Ghi chú của Admin:</strong> <span th:text="${order.adminNote}"></span></p>
							</div>
						</div>
					</div>

					<div class="box box-success">
						<div class="box-header with-border"><h3 class="box-title">Cập nhật trạng thái</h3></div>
						<form th:action="@{/admin/orders/update-status/{id}(id=${order.id})}" method="post">
							<div class="box-body">
								<div class="form-group">
									<label for="statusSelector">Chọn trạng thái mới</label>
									<select id="statusSelector" name="newStatus" class="form-control status-selector">
										<option th:each="s : ${T(com.group7.ecommerce.enums.OrderStatus).values()}" th:value="${s}" th:text="${s}" th:selected="${s == order.status}"></option>
									</select>
								</div>
								<div class="reason-block d-none">
									<div class="form-group">
										<label for="reasonId">Chọn lý do</label>
										<select id="reasonId" name="reasonId" class="form-control">
											<option value="">-- Không chọn --</option>
											<option th:each="reason : ${allReasons}" th:value="${reason.id}" th:text="${reason.description}"></option>
										</select>
									</div>
									<div class="form-group">
										<label for="adminNote">Ghi chú chi tiết (tùy chọn)</label>
										<textarea id="adminNote" name="adminNote" class="form-control" rows="3"></textarea>
									</div>
								</div>
							</div>
							<div class="box-footer">
								<button type="submit" class="btn btn-success pull-right"><i class="fa fa-save"></i> Lưu thay đổi</button>
							</div>
						</form>
					</div>
				</div>

				<div class="col-md-4">
					<div class="box box-info">
						<div class="box-header with-border"><h3 class="box-title">Thông tin giao hàng & Khách hàng</h3></div>
						<div class="box-body">
							<strong><i class="fa fa-user margin-r-5"></i> Khách hàng</strong>
							<p class="text-muted" th:text="${order.customerName}"></p>
							<p class="text-muted" th:text="${order.customerEmail}"></p>
							<p class="text-muted" th:text="${order.customerPhone}"></p>
							<hr>
							<strong><i class="fa fa-map-marker margin-r-5"></i> Giao hàng</strong>
							<p class="text-muted" th:text="'Người nhận: ' + ${order.shippingReceiver}"></p>
							<p class="text-muted" th:text="${order.shippingAddress}"></p>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>

	<footer th:replace="~{fragment/footer :: footer}"></footer>
</div>

<div th:replace="~{fragment/script :: script}"></div>

</body>
</html>
